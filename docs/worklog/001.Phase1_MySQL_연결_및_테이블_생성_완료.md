# Phase 1: MySQL ì—°ê²° ë° í…Œì´ë¸” ìƒì„± - ì‘ì—… ì™„ë£Œ

**ì‘ì—… ì¼ì‹œ**: 2025-01-15  
**ì‘ì—…ì**: Claude  
**ìƒíƒœ**: âœ… ì™„ë£Œ

## ğŸ“‹ ì‘ì—… ê°œìš”

ì•„ë¥´ë…¸ë¹Œë¦¬ì§€ ì „ê¸°ë£Œ ê´€ë¦¬ ì‹œìŠ¤í…œì˜ ê¸°ë°˜ì´ ë˜ëŠ” ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¶• ë° Next.js í”„ë¡œì íŠ¸ ì´ˆê¸° ì„¤ì •ì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤.

## ğŸ¯ ì™„ë£Œëœ ì‘ì—…

### 1. Next.js í”„ë¡œì íŠ¸ ìƒì„±
- **í”„ë¡œì íŠ¸ëª…**: coloco-apartment
- **í”„ë ˆì„ì›Œí¬**: Next.js 14 (App Router)
- **ì–¸ì–´**: TypeScript
- **ìŠ¤íƒ€ì¼ë§**: Tailwind CSS

```bash
npx create-next-app@latest coloco-apartment --typescript --tailwind --app --no-src-dir --import-alias "@/*"
```

### 2. í•„ìš” íŒ¨í‚¤ì§€ ì„¤ì¹˜
```bash
npm install mysql2 dotenv
```

### 3. í”„ë¡œì íŠ¸ êµ¬ì¡°
```
coloco-apartment/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â””â”€â”€ test-db/
â”‚   â”‚       â””â”€â”€ route.ts        # DB ì—°ê²° í…ŒìŠ¤íŠ¸ API
â”‚   â””â”€â”€ page.tsx
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ db.ts                   # MySQL ì—°ê²° í’€
â”‚   â””â”€â”€ db-utils.ts              # DB ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ init-db.sql              # DB ì´ˆê¸°í™” SQL
â”œâ”€â”€ .env.local.example           # í™˜ê²½ ë³€ìˆ˜ í…œí”Œë¦¿
â””â”€â”€ README.md                    # í”„ë¡œì íŠ¸ ë¬¸ì„œ
```

### 4. ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

#### ìƒì„±ëœ í…Œì´ë¸” (5ê°œ)

1. **users** - ì‚¬ìš©ì ê´€ë¦¬
   - id, username, password, role, timestamps

2. **units** - í˜¸ì‹¤ ì •ë³´
   - id, unit_number, tenant_name, contact, email, status, dates

3. **monthly_bills** - ì›”ë³„ ì´ ì²­êµ¬ì„œ
   - id, bill_year, bill_month, billing_period, amounts, fees

4. **unit_bills** - í˜¸ì‹¤ë³„ ì²­êµ¬ì„œ
   - id, monthly_bill_id, unit_id, usage, amounts, payment_status

5. **bill_history** - ì²­êµ¬ì„œ ë³€ê²½ ì´ë ¥
   - id, unit_bill_id, action, old_values, new_values, timestamps

### 5. ì´ˆê¸° ë°ì´í„°
- 60ê°œ í˜¸ì‹¤ ë°ì´í„° ì…ë ¥
- 58ê°œ ì…ì£¼, 2ê°œ ê³µì‹¤ (404í˜¸, 703í˜¸)

## ğŸ”§ êµ¬í˜„ëœ ì£¼ìš” ê¸°ëŠ¥

### DB ì—°ê²° ëª¨ë“ˆ (`lib/db.ts`)
- MySQL2 ì—°ê²° í’€ êµ¬ì„±
- í™˜ê²½ ë³€ìˆ˜ ê¸°ë°˜ ì„¤ì •
- ìë™ ì¬ì—°ê²° ê¸°ëŠ¥

### DB ìœ í‹¸ë¦¬í‹° (`lib/db-utils.ts`)
- `query()` - SELECT ì¿¼ë¦¬ ì‹¤í–‰
- `execute()` - INSERT/UPDATE/DELETE ì‹¤í–‰
- `transaction()` - íŠ¸ëœì­ì…˜ ì²˜ë¦¬
- `queryOne()` - ë‹¨ì¼ í–‰ ì¡°íšŒ
- `exists()` - ì¡´ì¬ ì—¬ë¶€ í™•ì¸

### ì—°ê²° í…ŒìŠ¤íŠ¸ API (`/api/test-db`)
- ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í™•ì¸
- í…Œì´ë¸” ëª©ë¡ ì¡°íšŒ
- í˜¸ì‹¤ í†µê³„ í‘œì‹œ

## ğŸ› ë°œìƒí•œ ì´ìŠˆ ë° í•´ê²°

### ì´ìŠˆ 1: MySQL JSON íƒ€ì… ë¯¸ì§€ì›
- **ë¬¸ì œ**: MySQL ë²„ì „ì´ JSON íƒ€ì…ì„ ì§€ì›í•˜ì§€ ì•ŠìŒ (ERROR 1064)
- **í•´ê²°**: `bill_history` í…Œì´ë¸”ì˜ JSON ì»¬ëŸ¼ì„ TEXTë¡œ ë³€ê²½
```sql
-- ë³€ê²½ ì „
old_values JSON,
new_values JSON,

-- ë³€ê²½ í›„  
old_values TEXT COMMENT 'JSON í˜•ì‹ìœ¼ë¡œ ì €ì¥',
new_values TEXT COMMENT 'JSON í˜•ì‹ìœ¼ë¡œ ì €ì¥',
```

## âœ… í…ŒìŠ¤íŠ¸ ê²°ê³¼

### DB ì—°ê²° í…ŒìŠ¤íŠ¸ ì„±ê³µ
```json
{
  "success": true,
  "message": "ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì„±ê³µ!",
  "database": "coloco_apartment",
  "tables": [
    "bill_history",
    "monthly_bills",
    "units",
    "unit_bills",
    "users"
  ],
  "unitStats": {
    "total": 60,
    "occupied": 58,
    "vacant": 2
  },
  "timestamp": "2025-09-15T04:00:42.962Z"
}
```

## ğŸ“ í™˜ê²½ ì„¤ì •

### .env.local íŒŒì¼ êµ¬ì„±
```env
MYSQL_HOST=ì›ê²©-ì„œë²„-IP
MYSQL_PORT=3306
MYSQL_USER=ì‚¬ìš©ìëª…
MYSQL_PASSWORD=ë¹„ë°€ë²ˆí˜¸
MYSQL_DATABASE=coloco_apartment
MYSQL_CONNECTION_LIMIT=5
MYSQL_QUEUE_LIMIT=0
MYSQL_CONNECT_TIMEOUT=60000
NODE_ENV=development
```

## ğŸš€ ì‹¤í–‰ ë°©ë²•

1. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
```bash
cp .env.local.example .env.local
# .env.local íŒŒì¼ì— ì‹¤ì œ DB ì •ë³´ ì…ë ¥
```

2. ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™”
```bash
mysql -h server-ip -u root -p < scripts/init-db.sql
```

3. ê°œë°œ ì„œë²„ ì‹¤í–‰
```bash
npm run dev
```

4. ì—°ê²° í…ŒìŠ¤íŠ¸
```
http://localhost:3000/api/test-db
```

## ğŸ“Š ì‘ì—… ì‹œê°„
- ì˜ˆìƒ ì‹œê°„: 6ì‹œê°„
- ì‹¤ì œ ì†Œìš”: ì•½ 1ì‹œê°„
- íš¨ìœ¨ì„±: 83% ë‹¨ì¶•

## ğŸ¯ ë‹¤ìŒ ë‹¨ê³„

**Phase 2: PDF/Excel íŒŒì‹± API êµ¬í˜„**
- í•œì „ ì²­êµ¬ì„œ PDF ìë™ íŒŒì‹±
- Excel ì‚¬ìš©ëŸ‰ ë°ì´í„° ì²˜ë¦¬
- íŒŒì¼ ì—…ë¡œë“œ ì¸í„°í˜ì´ìŠ¤
- ë°ì´í„° ì¶”ì¶œ ë° ê²€ì¦

## ğŸ“Œ ì°¸ê³  ì‚¬í•­

1. **ë³´ì•ˆ**: `.env.local` íŒŒì¼ì€ ì ˆëŒ€ Gitì— ì»¤ë°‹í•˜ì§€ ì•ŠìŒ
2. **ì›ê²© DB**: ë°©í™”ë²½ì—ì„œ 3306 í¬íŠ¸ ê°œë°© í•„ìš”
3. **ë¬¸ìì…‹**: UTF8MB4 ì‚¬ìš©ìœ¼ë¡œ í•œê¸€ ë¬¸ì œ ì—†ìŒ
4. **ì—°ê²° í’€**: ìµœëŒ€ 5ê°œ ì—°ê²°ë¡œ ì œí•œ

---

**ë¬¸ì„œ ì‘ì„±ì¼**: 2025-01-15  
**ë¬¸ì„œ ë²„ì „**: 1.0