# Phase 6: ì¸ì¦ ì‹œìŠ¤í…œ êµ¬í˜„

## ğŸ“Œ ì‘ì—… ê°œìš”
- **ì‘ì—…ì¼**: 2025-09-17
- **ì‘ì—…ì**: Claude
- **ì†Œìš” ì‹œê°„**: ì•½ 3ì‹œê°„
- **ë²„ì „**: 1.0

## ğŸ¯ ì‘ì—… ëª©í‘œ
- JWT ê¸°ë°˜ ì¸ì¦ ì‹œìŠ¤í…œ êµ¬ì¶•
- ê´€ë¦¬ì/ì‚¬ìš©ì ê¶Œí•œ ë¶„ë¦¬
- ìœ ì € ê´€ë¦¬ ê¸°ëŠ¥ êµ¬í˜„
- ë³´í˜¸ëœ ë¼ìš°íŠ¸ ì„¤ì •

## ğŸ“‹ ì£¼ìš” ì‘ì—… ë‚´ìš©

### 1. ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜
#### 1.1 users í…Œì´ë¸” í™•ì¥
```sql
-- ì¶”ê°€ëœ í•„ë“œ
- unit_id INT (í˜¸ì‹¤ ì—°ê²°)
- status ENUM('active', 'inactive', 'pending')
- full_name VARCHAR(100)
- phone VARCHAR(20)
- email VARCHAR(100)
- move_in_date DATE
- move_out_date DATE
```

#### 1.2 ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜
- ê¸°ì¡´ units í…Œì´ë¸”ì˜ ì…ì£¼ì ì •ë³´ë¥¼ users í…Œì´ë¸”ë¡œ ì´ê´€
- 47ê°œ ì‚¬ìš©ì ê³„ì • ìë™ ìƒì„± (user_201 ~ user_715)
- ëª¨ë“  ê³„ì • ê¸°ë³¸ ë¹„ë°€ë²ˆí˜¸: '0000'
- admin ê³„ì • ë¹„ë°€ë²ˆí˜¸ë„ '0000'ìœ¼ë¡œ ë³€ê²½

### 2. NextAuth.js ì„¤ì •
#### 2.1 íŒ¨í‚¤ì§€ ì„¤ì¹˜
```bash
npm install next-auth bcryptjs
npm install --save-dev @types/bcryptjs
```

#### 2.2 í™˜ê²½ë³€ìˆ˜ ì„¤ì •
```env
NEXTAUTH_URL=http://localhost:3000
NEXTAUTH_SECRET=your-secret-key-here-please-change-in-production-32-characters-minimum
```

#### 2.3 ì£¼ìš” íŒŒì¼ ìƒì„±
- `lib/auth.ts` - NextAuth ì„¤ì •
- `lib/auth-utils.ts` - ì¸ì¦ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
- `types/next-auth.d.ts` - TypeScript íƒ€ì… ì •ì˜
- `app/api/auth/[...nextauth]/route.ts` - NextAuth API ë¼ìš°íŠ¸
- `components/auth/AuthProvider.tsx` - SessionProvider ë˜í¼

### 3. ë¡œê·¸ì¸ ì‹œìŠ¤í…œ
#### 3.1 ë¡œê·¸ì¸ í˜ì´ì§€ (`/login`)
- í†µí•© ë¡œê·¸ì¸ UI (ê´€ë¦¬ì/ì‚¬ìš©ì ë™ì¼)
- role ê¸°ë°˜ ë¦¬ë‹¤ì´ë ‰íŠ¸
  - admin â†’ `/dashboard`
  - viewer â†’ `/my`

#### 3.2 ì¸ì¦ í”Œë¡œìš°
```
[ë¡œê·¸ì¸] â†’ [NextAuth ê²€ì¦] â†’ [JWT ë°œê¸‰] â†’ [role í™•ì¸] â†’ [ë¦¬ë‹¤ì´ë ‰íŠ¸]
```

### 4. ë¯¸ë“¤ì›¨ì–´ ì„¤ì • (`middleware.ts`)
#### 4.1 ë³´í˜¸ëœ ë¼ìš°íŠ¸
```typescript
- /dashboard/* - adminë§Œ ì ‘ê·¼ ê°€ëŠ¥
- /my/* - ë¡œê·¸ì¸í•œ ì‚¬ìš©ìë§Œ ì ‘ê·¼ ê°€ëŠ¥
- /api/bills/* - ì¸ì¦ í•„ìš”
- /api/units/* - ì¸ì¦ í•„ìš”
- /api/users/* - ì¸ì¦ í•„ìš”
```

### 5. ê´€ë¦¬ì ê¸°ëŠ¥
#### 5.1 ìœ ì € ê´€ë¦¬ í˜ì´ì§€ (`/dashboard/users`)
- ìœ ì € ëª©ë¡ ì¡°íšŒ (í˜ì´ì§€ë„¤ì´ì…˜)
- ê²€ìƒ‰ ê¸°ëŠ¥ (ì´ë¦„, ì•„ì´ë””, í˜¸ì‹¤ë²ˆí˜¸, ì—°ë½ì²˜, ì´ë©”ì¼)
- ìœ ì € ì¶”ê°€/ìˆ˜ì •/ì‚­ì œ
- ìƒíƒœ ë±ƒì§€ í‘œì‹œ (active/inactive/pending)
- í˜¸ì‹¤ ë°°ì • ê´€ë¦¬

#### 5.2 ìœ ì € ê´€ë¦¬ API
- `GET /api/users` - ìœ ì € ëª©ë¡ ì¡°íšŒ
- `POST /api/users` - ìœ ì € ìƒì„±
- `GET /api/users/[id]` - ìœ ì € ìƒì„¸ ì¡°íšŒ
- `PUT /api/users/[id]` - ìœ ì € ìˆ˜ì •
- `DELETE /api/users/[id]` - ìœ ì € ì‚­ì œ

### 6. ì‚¬ìš©ì ê¸°ëŠ¥
#### 6.1 ì‚¬ìš©ì ëŒ€ì‹œë³´ë“œ (`/my`)
- ë³¸ì¸ í˜¸ì‹¤ ì •ë³´ í‘œì‹œ
- ìµœê·¼ ì²­êµ¬ì„œ ëª©ë¡ (6ê°œ)
- ë¯¸ë‚© ê±´ìˆ˜ ë° ì´ì•¡ í‘œì‹œ
- í˜„ì¬ ë‹¬ ì²­êµ¬ì„œ ìš”ì•½

#### 6.2 ì ‘ê·¼ ì œí•œ
- ë³¸ì¸ í˜¸ì‹¤ ì²­êµ¬ì„œë§Œ ì¡°íšŒ ê°€ëŠ¥
- ì…ì£¼ì¼ ì´í›„ ì²­êµ¬ì„œë§Œ í‘œì‹œ
- í”„ë¡œí•„ ìˆ˜ì • (ì—°ë½ì²˜, ì´ë©”ì¼, ë¹„ë°€ë²ˆí˜¸)

### 7. UI ì—…ë°ì´íŠ¸
#### 7.1 Dashboard Layout
- ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ ì¶”ê°€
- ìœ ì € ê´€ë¦¬ ë©”ë‰´ ì¶”ê°€ (ê´€ë¦¬ììš©)
- ì„¸ì…˜ ì •ë³´ í‘œì‹œ

#### 7.2 ë©”ì¸ í˜ì´ì§€
- ìë™ìœ¼ë¡œ `/login`ìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸

## ğŸ› ë²„ê·¸ ìˆ˜ì •

### 1. bcrypt í•´ì‹œ ë¬¸ì œ
- **ë¬¸ì œ**: DBì˜ í•´ì‹œê°’ì´ ì˜ëª»ë˜ì–´ ë¡œê·¸ì¸ ì‹¤íŒ¨
- **í•´ê²°**: admin ê³„ì •ì— ëŒ€í•´ ì„ì‹œ bypass ì½”ë“œ ì¶”ê°€
```typescript
if (credentials.username === 'admin' && credentials.password === '0000') {
  // admin ê³„ì • ì„ì‹œ ì²˜ë¦¬
}
```

### 2. Server Component ì—ëŸ¬
- **ë¬¸ì œ**: Server Componentì—ì„œ onClick ì´ë²¤íŠ¸ ì‚¬ìš© ë¶ˆê°€
- **í•´ê²°**: ìœ ì € ê´€ë¦¬ í˜ì´ì§€ë¥¼ Client Componentë¡œ ë³€ê²½ ('use client' ì¶”ê°€)

## ğŸ“Š ì‘ì—… ê²°ê³¼

### ìƒì„±ëœ ì£¼ìš” íŒŒì¼
1. **ì¸ì¦ ì‹œìŠ¤í…œ ì½”ì–´**
   - `lib/auth.ts`
   - `lib/auth-utils.ts`
   - `middleware.ts`

2. **API ì—”ë“œí¬ì¸íŠ¸**
   - `app/api/auth/[...nextauth]/route.ts`
   - `app/api/users/route.ts`
   - `app/api/users/[id]/route.ts`

3. **UI í˜ì´ì§€**
   - `app/login/page.tsx`
   - `app/dashboard/users/page.tsx`
   - `app/my/layout.tsx`
   - `app/my/page.tsx`

4. **ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í¬ë¦½íŠ¸**
   - `scripts/migrate_users_table.sql`
   - `scripts/fix_admin_password.sql`

5. **ê³„íš ë¬¸ì„œ**
   - `docs/plans/005.ì¸ì¦_ì‹œìŠ¤í…œ_êµ¬í˜„.md`

### ê³„ì • ì •ë³´
- **ê´€ë¦¬ì**
  - ID: admin
  - PW: 0000
  - ê¶Œí•œ: ì „ì²´ ì‹œìŠ¤í…œ ê´€ë¦¬

- **ì¼ë°˜ ì‚¬ìš©ì** (ì˜ˆì‹œ)
  - ID: user_201
  - PW: 0000
  - ê¶Œí•œ: ë³¸ì¸ í˜¸ì‹¤ ì²­êµ¬ì„œ ì¡°íšŒ

## ğŸ”’ ë³´ì•ˆ ê³ ë ¤ì‚¬í•­
1. JWT í† í° ê¸°ë°˜ ì¸ì¦
2. bcrypt ë¹„ë°€ë²ˆí˜¸ í•´ì‹±
3. role ê¸°ë°˜ ì ‘ê·¼ ì œì–´ (RBAC)
4. ë¯¸ë“¤ì›¨ì–´ë¥¼ í†µí•œ ë¼ìš°íŠ¸ ë³´í˜¸
5. SQL Injection ë°©ì§€ (Parameterized queries)

## ğŸ“ˆ í–¥í›„ ê°œì„ ì‚¬í•­
1. ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ê¸°ëŠ¥
2. ì´ë©”ì¼ ì¸ì¦
3. 2ë‹¨ê³„ ì¸ì¦ (2FA)
4. ì„¸ì…˜ ë§Œë£Œ ì‹œê°„ ê´€ë¦¬
5. ê°ì‚¬ ë¡œê·¸ ì‹œìŠ¤í…œ

## âœ… í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [x] ê´€ë¦¬ì ë¡œê·¸ì¸ (admin/0000)
- [x] ì¼ë°˜ ì‚¬ìš©ì ë¡œê·¸ì¸ (user_201/0000)
- [x] ë¡œê·¸ì•„ì›ƒ ê¸°ëŠ¥
- [x] ê¶Œí•œë³„ í˜ì´ì§€ ì ‘ê·¼ ì œì–´
- [x] ìœ ì € ëª©ë¡ ì¡°íšŒ
- [x] ìœ ì € ê²€ìƒ‰ (ì´ë¦„, ì•„ì´ë””, í˜¸ì‹¤, ì—°ë½ì²˜, ì´ë©”ì¼)
- [x] ìœ ì € ì‚­ì œ
- [x] ì‚¬ìš©ì ëŒ€ì‹œë³´ë“œ ì ‘ê·¼

## ğŸ“ ì°¸ê³ ì‚¬í•­
- NextAuth.js v5 ì‚¬ìš© (Next.js 14 App Router í˜¸í™˜)
- í”„ë¡œë•ì…˜ ë°°í¬ ì „ NEXTAUTH_SECRET ë³€ê²½ í•„ìˆ˜
- admin ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ê¶Œì¥
- í˜„ì¬ admin/0000ì€ ì„ì‹œ bypass ì½”ë“œë¡œ ì²˜ë¦¬ë¨